
### DEXTRAN PROJECT METADATA
### analyze mesoscale simulations generated by Samaneh

variables:
  raw_data:
    semi_rigid: /home/rpb/liminal/samrad-curvature/ResultsForSemiRigid
    low_dex: /home/rpb/liminal/samrad-curvature/Low_Excess_Area/ResultsForDex

# groups of simulations to analyze together (REQUIRED)
collections:
  all:
    - CL160ENS-1
  more:
    - SemiRigidE1
    - SemiRigidE2
    - SemiRigidE3
    - RigidNCE1
    - RigidNCE2
    - RigidNCE3
    - SemiRigidE1_50
    - SemiRigidE2_50
    - SemiRigidE3_50
    - CL160ENS-1
    - CL160ENS-2
    - CL160ENS-3

slices:

  SemiRigidE1:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigid
        directory: SemiRigidE1
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE2:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigid
        directory: SemiRigidE2
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE3:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigid
        directory: SemiRigidE3 #! an error!
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat

  RigidNCE1:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForRigid
        directory: RigidNCE1
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  RigidNCE2:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForRigid
        directory: RigidNCE2
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  RigidNCE3:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForRigid
        directory: RigidNCE3
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat

  SemiRigidE1_50:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigidRad50
        directory: SemiRigidE1_50
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE2_50:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigidRad50
        directory: SemiRigidE2_50
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE3_50:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigidRad50
        directory: SemiRigidE3_50
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat

  CL160ENS-1:
    readymade_meso_v1:
      current:
        path: +raw_data/low_dex
        directory: CL160ENS-1
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NG_Position-0_Frame-0.dat
  CL160ENS-2:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForDex
        directory: CL160ENS-2
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NG_Position-0_Frame-0.dat
  CL160ENS-3:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForDex
        directory: CL160ENS-3
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NG_Position-0_Frame-0.dat

meta:

  SemiRigidE1:
    name: "Semi-rigid (25 nm, rep. 1)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE2: 
    name: "Semi-rigid (25 nm, rep. 2)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE3: 
    name: "Semi-rigid (25 nm, rep. 3)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True

  RigidNCE1: 
    name: "Rigid (rep. 1)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  RigidNCE2: 
    name: "Rigid (rep. 2)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  RigidNCE3: 
    name: "Rigid (rep. 2)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True

  SemiRigidE1_50: 
    name: "Rigid (rep. 1)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE2_50: 
    name: "Rigid (rep. 2)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE3_50: 
    name: "Rigid (rep. 3)"
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True

  CL160ENS-1: 
    name: "Nanogel (rep. 1)"
    frames_realign: True
  CL160ENS-2: 
    name: "Nanogel (rep. 2)"
    frames_realign: True
  CL160ENS-3: 
    name: "Nanogel (rep. 3)"
    frames_realign: True
    
calculations:

  import_readymade_meso_v1_membrane:
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      grid_spacing: 10.0

  import_readymade_meso_v1_nanogel:
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      mapping_style: single_inducer 

  undulations_average_normal:
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      upstream: 
        import_readymade_meso_v1_membrane: {}

  curvature_undulation_coupling_dex:
    ignore: false
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      upstream:
        import_readymade_meso_v1_membrane: {}
        import_readymade_meso_v1_nanogel: {}
      fitting:
        initial_kappa: 10.0
        high_cutoff: 0.2
      design:
        loop:
          # compare small vs large samples and optimizers
          v01:
            samples: 100
            optimize_method: SLSQP
            style: wilderness
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          v02:
            samples: 100
            optimize_method: BFGS
            style: wilderness
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          v03:
            samples: -1
            optimize_method: SLSQP
            style: wilderness
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          v04:
            samples: -1
            optimize_method: BFGS
            style: wilderness
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # investigate binning strategy
          v05:
            samples: 100
            optimize_method: BFGS
            #! why is this so small? we got more points with the undulations?
            bin_width: 0.01
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          v06:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # larger neighborhood
          v07:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 100.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # positive tension
          v08:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: True
            positive_tension: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # no tension
          v09:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: True
            tension: False
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean

          # at this point v08 and v09 give higher error than v06 and v07
          # presumably because they omit tension or try positive tension
          # v07 is better than v06 probably because it has a larger neighborhood
          # the high negative tension in v07 (the best fit so far, I think) is 
          # probably compensating for curvature, which I find very interesting.
          # upcoming tests include trying a different midplane method, a still-
          # larger neighborhood, and finally the pixel method
          # return to the pixel method

          # alternate midplane method 
          # note average_normal requires more loader code so we do average which gives very similar results
          #! this was not correctly implemented at first
          #! it also gave lower error than v07 which is weird because it should have been identical given the fact that the midplane method was not implemented correctly
          v10:
            samples: 100
            optimize_method: BFGS
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: average
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 100.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # try the pixel method
          v11:
            samples: 100
            optimize_method: BFGS
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            style: wilderness
            curvature_positions: 
              method: pixel
              spacer: 100.0
            extents:
              method: fixed_isotropic
              extent: 50.0
            curvature_sum: mean
          # finer
          v12:
            samples: 100
            optimize_method: BFGS
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            style: wilderness
            curvature_positions: 
              method: pixel
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # an explicit bin version of v05 or a v02 method with initial fit and no vibe
          # this is more of a repeatability test which should resemble v02 or at least tell us
          # how important initial fit and vibration are
          #! ignoring these because they di not look any different from v02
          v13:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: False
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # test the importance of the initial fit compared to v13
          v14:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: False
            initial_fit: False
            vibe: False
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # v10 with the small neighborhood
          v15:
            samples: 100
            optimize_method: BFGS
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: average
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # v10 with the small neighborhood and very fine extents
          v16:
            samples: 100
            optimize_method: BFGS
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: average
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 20.0
            extents:
              method: fixed_isotropic
              extent: 10.0
            curvature_sum: mean
          # v16 and ignoring rotation (115 minutes)
          v17:
            samples: 100
            optimize_method: BFGS
            perfect_collapse: True
            initial_fit: True
            vibe: False
            style: wilderness
            midplane_method: average
            ignore_rotation: True
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 20.0
            extents:
              method: fixed_isotropic
              extent: 10.0
            curvature_sum: mean
          # new binning strategy. this utterly failed
          v18:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: True
            initial_fit: True
            vibe: False
            perfect_collapse_weighted: True
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 100.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # v02 without rotation and abandoned the perfect_collapse_weighted from v18
          v19:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: True
            initial_fit: True
            vibe: False
            ignore_rotation: True
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 100.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          # v18 without rotation
          v20:
            samples: 100
            optimize_method: BFGS
            bin_width: False
            perfect_collapse: True
            initial_fit: True
            vibe: False
            perfect_collapse_weighted: True
            ignore_rotation: True
            style: wilderness
            midplane_method: flat
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 100.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean

plots:

  curvature_undulation_coupling:
    script: dextran_undulation_review.py
    collections: all
    calculation: 
      import_readymade_meso_v1_nanogel: {}
      import_readymade_meso_v1_membrane: {}
      undulations_average_normal: {}
    specs:
      calcname: curvature_undulation_coupling_dex
      loader: 
        module: calcs.codes.curvature_coupling_loader_dex
        function: prepare_mesoscale_postdat
      undulations_name: import_readymade_meso_v1_membrane
      protein_abstractor_name: import_readymade_meso_v1_nanogel
