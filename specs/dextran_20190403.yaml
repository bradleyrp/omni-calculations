
#! previously from dextran50.yaml and dextran100.yaml
#!   now being updated for new data in 2019.03

### DEXTRAN PROJECT METADATA
### analyze mesoscale simulations generated by Samaneh

# groups of simulations to analyze together (REQUIRED)
collections:
  all_DEPRECATED:
    #- CL100ENS-2
    #- CL100ENS-3
    - CL160ENS-1
    - CL160ENS-2
    - CL160ENS-3
    #! no nanogel? - CL160ENS-4
  all:
    - SemiRigidE1
    - SemiRigidE2
    - SemiRigidE3
    - RigidNCE1
    - RigidNCE2
    - RigidNCE3
    - SemiRigidE1_50
    - SemiRigidE2_50
    - SemiRigidE3_50

# pointers to the data (REQUIRED)
slices_DEPRECATED: |
  CL160ENS-1:
    readymade_meso_v1:
      current:
        path: +paths/mem_undulation
        directory: CL160ENS-1
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NG_Position-0_Frame-0.dat
  CL160ENS-2:
    readymade_meso_v1:
      current:
        path: +paths/mem_undulation
        directory: CL160ENS-2
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NG_Position-0_Frame-0.dat
  CL160ENS-3:
    readymade_meso_v1:
      current:
        path: +paths/mem_undulation
        directory: CL160ENS-3
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NG_Position-0_Frame-0.dat
  CL160ENS-4:
    readymade_meso_v1:
      current:
        path: +paths/mem_undulation
        directory: CL160ENS-4
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NG_Position-0_Frame-0.dat

slices:

  SemiRigidE1:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigid
        directory: SemiRigidE1
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE2:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigid
        directory: SemiRigidE2
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE3:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigid
        directory: SemiRigidE3 #! an error!
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat

  RigidNCE1:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForRigid
        directory: RigidNCE1
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  RigidNCE2:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForRigid
        directory: RigidNCE2
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  RigidNCE3:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForRigid
        directory: RigidNCE3
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat

  SemiRigidE1_50:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigidRad50
        directory: SemiRigidE1_50
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE2_50:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigidRad50
        directory: SemiRigidE2_50
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat
  SemiRigidE3_50:
    readymade_meso_v1:
      current:
        path: /home/localshare/samrad-curvature/Low_Excess_Area/ResultsForSemiRigidRad50
        directory: SemiRigidE3_50
        membrane_xyz_glob: memb_xyz-0-0-*.xyz
        nanogel_dat: NC-Antibody-Data-ENS-0_Frame-0.dat

meta:
  SemiRigidE1: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE2: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE3: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True

  RigidNCE1: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  RigidNCE2: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  RigidNCE3: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True

  SemiRigidE1_50: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE2_50: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True
  SemiRigidE3_50: 
    import_nanogel_alt: import_nanogel_positions_rigid
    frames_realign: True

# metadata for each simulation (OPTIONAL)
meta_DEPRECATED:
  free_membrane_cl0: {}
  bound_membrane_cl0: {}

# avoid repetition inside this YAML file (OPTIONAL)
variables_DEPRECATED:
  paths:
    #! mem_undulation: /store-iota/MASTER/Samrad/Mem_Undulation
    #! mem_undulation: /Users/rpb/worker/simulations/samrad-curvature-2019.03.00/ResultsForDex/
    
# which calculations to perform (REQUIRED) via `make compute`
calculations:
  # convert simulation outputs to points on a regular mesh
  import_readymade_meso_v1_membrane:
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      # we assume units are literal nm in the upstream data and use the following interpolation interval
      #! changed to 10.0 for less data
      grid_spacing: 10.0
  # read and save the nanogel points in a structure that mimics the protein_abstractor data type
  import_readymade_meso_v1_nanogel:
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      mapping_style: single_inducer 
  undulations_average_normal:
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      upstream: 
        import_readymade_meso_v1_membrane: {}
  # gently-modified version of the curvature_undulation_coupling calculation which
  # ...substitutes the MD inputs for the mesoscale inputs specific to this project
  curvature_undulation_coupling_dex:
    ignore: false
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      upstream:
        import_readymade_meso_v1_membrane: {}
        import_readymade_meso_v1_nanogel: {}
      fitting:
        initial_kappa: 10.0
        high_cutoff: 0.2
      design:
        loop:
          v3:
            style: wilderness
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 50.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean
          v4:
            style: wilderness
            curvature_positions: 
              method: pixel
              spacer: 80.0
            extents:
              method: fixed_isotropic
              extent: 40.0
            curvature_sum: mean
          v5:
            style: wilderness
            curvature_positions: 
              method: neighborhood
              distance_cutoff: 100.0
              spacer: 40.0
            extents:
              method: fixed_isotropic
              extent: 20.0
            curvature_sum: mean

          #v4:
          #  style: wilderness
          #  curvature_positions: 
          #    method: neighborhood
          #    distance_cutoff: 100.0
          #    spacer: 40.0
          #  extents:
          #    method: fixed_isotropic
          #    extent: 20.0
          #  curvature_sum: mean
          # added midplane method here
          #v5:
          #  style: wilderness
          #  curvature_positions: 
          #    method: neighborhood
          #    distance_cutoff: 50.0
          #    spacer: 40.0
          #  extents:
          #    method: fixed_isotropic
          #    extent: 20.0
          #  curvature_sum: mean
          #  midplane_method: average
  # duplicate of the pixel method for dextran
  #! is this still being used??
  curvature_undulation_coupling_pixel_dex:
    uptype: post
    group: all
    slice_name: current
    collections: all
    specs:
      upstream:
        import_readymade_meso_v1_membrane: {}
      fitting:
        initial_kappa: 10.0
        high_cutoff: 0.2
      design:
        loop:
          v10:
            style: wilderness
            curvature_positions: 
              method: pixel
              spacer: 200.0
            extents:
              method: fixed_isotropic
              extent: 100.0
            curvature_sum: mean
          v11:
            style: wilderness
            curvature_positions: 
              method: pixel
              spacer: 150.0
            extents:
              method: fixed_isotropic
              extent: 75.0
            curvature_sum: mean
          v12:
            style: wilderness
            curvature_positions: 
              method: pixel
              spacer: 100.0
            extents:
              method: fixed_isotropic
              extent: 50.0
            curvature_sum: mean
          #v13:
          #  style: wilderness
          #  curvature_positions: 
          #    method: pixel
          #    spacer: 80.0
          #  extents:
          #    method: fixed_isotropic
          #    extent: 40.0
          #  curvature_sum: mean
          #v14:
          #  style: wilderness
          #  curvature_positions: 
          #    method: pixel
          #    spacer: 60.0
          #  extents:
          #    method: fixed_isotropic
          #    extent: 30.0
          #  curvature_sum: mean
          #v15:
          #  style: wilderness
          #  curvature_positions: 
          #    method: pixel
          #    spacer: 50.0
          #  extents:
          #    method: fixed_isotropic
          #    extent: 25.0
          #  curvature_sum: mean

# which data to load for plotting (REQUIRED unless you use the same exact name as the calculation)
plots:
  # read the membrane interpolation and compute undulation spectra
  undulations:
    collections: all
    calculation:
      import_readymade_meso_v1_membrane: {}
    specs: 
      routine:
        - spectra
        #- height
        #- height_histograms
        #- debug3d
      show_fit: False
      midplane_method: average_normal
      wavevector_limits: [0.2,0.3,1.0]
  undulations_legacy:
    # remove this when it becomes unnecessary!
    collections: all
    calculation:
      import_readymade_meso_v1_membrane: {}
    specs: 
      routine:
        - spectra
        #- height
        #- height_histograms
        #- debug3d
      show_fit: False
      midplane_method: average_normal
      wavevector_limits: [0.2,0.3,1.0]
  # point our custom calculation to the right plot function
  curvature_undulation_coupling_DEPRECATED:
    calculation: 
      curvature_undulation_coupling_dex:
        design: v3
      import_readymade_meso_v1_nanogel: {}
      import_readymade_meso_v1_membrane: {}
    collections: all
    specs: 
      # alternate names to match the calculation inputs above
      calcname: curvature_undulation_coupling_dex
      protein_abstractor_name: import_readymade_meso_v1_nanogel
      undulations_name: import_readymade_meso_v1_membrane
      # alternate loaders for interpreting the nanogel positions
      loader: 
        module: codes.curvature_coupling_loader_dex
        function: prepare_mesoscale_postdat
      # which plots to make
      routine:
        - curvature_field_review
        - individual_reviews
  # point our custom calculation to the right plot function
  curvature_undulation_coupling_pixel:
    calculation:
      # choose the subject of the plots here, for plots with only one subject
      # ... note however that the pixel plot also uses a sweep over all upstream loops for comparison
      curvature_undulation_coupling_pixel_dex:
        design: v12
    collections: all
    specs:
      calcname: curvature_undulation_coupling_pixel_dex
  # export undulation coupling data
  dextran_analyze_undulations:
    calculation: 
      curvature_undulation_coupling_dex:
        design: v1
    collections: all
  mesh-improve:
    calculation:
      import_readymade_meso_v1_membrane: {}

  #! refactoring the plots here
  curvature_undulation_coupling:
    script: dextran_undulation_review.py
    collections: all
    calculation: 
      curvature_undulation_coupling_dex:
        design: v3 # v3 v4 v5 THIS IS WHERE YOU ARE AT!
      import_readymade_meso_v1_nanogel: {}
      import_readymade_meso_v1_membrane: {}
    specs:
      # alternate names to match the calculation inputs above
      calcname: curvature_undulation_coupling_dex
      # alternate loaders for interpreting the nanogel positions
      loader: 
        module: calcs.codes.curvature_coupling_loader_dex
        function: prepare_mesoscale_postdat
      # where to find source data on incoming calculations
      undulations_name: import_readymade_meso_v1_membrane
      protein_abstractor_name: import_readymade_meso_v1_nanogel
  notes: |
    collections: all
    specs: 
      # alternate names to match the calculation inputs above
      calcname: curvature_undulation_coupling_dex
      protein_abstractor_name: import_readymade_meso_v1_nanogel
      undulations_name: import_readymade_meso_v1_membrane
      # alternate loaders for interpreting the nanogel positions
      loader: 
        module: codes.curvature_coupling_loader_dex
        function: prepare_mesoscale_postdat
      # which plots to make
      routine:
        - curvature_field_review
        - individual_reviews
